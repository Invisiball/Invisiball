if(!window.THREEUtils){window.THREEUtils={}}THREEUtils.Shape2Mesh=function(t,n){var r=new THREE.Object3D;for(var i=0;i<t.shapes.length;i++){var s=t.shapes[i];var o;switch(s.type){case CANNON.Shape.types.BOX:var u=new THREE.BoxGeometry(s.halfExtents.x*2,s.halfExtents.y*2,s.halfExtents.z*2);o=new THREE.Mesh(u,n);break;case CANNON.Shape.types.HEIGHTFIELD:var a=new THREE.Geometry;var f=new CANNON.Vec3;var l=new CANNON.Vec3;var c=new CANNON.Vec3;for(var h=0;h<s.data.length-1;h++){for(var p=0;p<s.data[h].length-1;p++){for(var d=0;d<2;d++){s.getConvexTrianglePillar(h,p,d===0);f.copy(s.pillarConvex.vertices[0]);l.copy(s.pillarConvex.vertices[1]);c.copy(s.pillarConvex.vertices[2]);f.vadd(s.pillarOffset,f);l.vadd(s.pillarOffset,l);c.vadd(s.pillarOffset,c);a.vertices.push(new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(l.x,l.y,l.z),new THREE.Vector3(c.x,c.y,c.z));var v=a.vertices.length-3;a.faces.push(new THREE.Face3(v,v+1,v+2))}}}a.computeBoundingSphere();a.computeFaceNormals();o=new THREE.Mesh(a,n);break}o.receiveShadow=true;o.castShadow=true;if(o.children){for(var v=0;v<o.children.length;v++){o.children[v].castShadow=true;o.children[v].receiveShadow=true;if(o.children[v]){for(var m=0;m<o.children[v].length;m++){o.children[v].children[m].castShadow=true;o.children[v].children[m].receiveShadow=true}}}}var g=t.shapeOffsets[i];var y=t.shapeOrientations[i];o.position.set(g.x,g.y,g.z);o.quaternion.set(y.x,y.y,y.z,y.w);r.add(o)}return r}